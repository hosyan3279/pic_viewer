# UI/UX詳細設計

## 1. 概要

本ドキュメントでは、画像ビューワーアプリケーションのUI/UX（ユーザーインターフェース/ユーザーエクスペリエンス）の詳細設計を定義する。このアプリケーションはPyQt6/PySide6を使用して実装される。

### 1.1 設計方針

- **直感的な操作性**: ユーザーが迷わず使えるシンプルなUI
- **効率的なワークフロー**: 画像閲覧や分類作業を効率的に行えるUI構成
- **視覚的な明確さ**: 情報が見やすく、重要な要素が強調されるデザイン
- **カスタマイズ性**: ユーザーが自分の好みに合わせて調整できる柔軟性
- **一貫性**: 操作方法や見た目の一貫性を維持
- **アクセシビリティ**: 様々なユーザーが利用しやすいデザイン

### 1.2 主要画面

アプリケーションは以下の主要画面から構成される：

1. **メイン画面**: 画像表示とフォルダ閲覧を行う画面
2. **設定画面**: アプリケーションの設定を行う画面
3. **分類管理画面**: 分類モデルの管理と実行を行う画面
4. **タグ管理画面**: タグの管理を行う画面
5. **バッチ処理画面**: 複数画像の一括処理を行う画面

## 2. メイン画面の設計

### 2.1 全体レイアウト

メイン画面は次の領域に分割される：

```
+------------------------------------------+
| メニューバー                               |
+------------------------------------------+
| ツールバー                                |
+--------+---------------------------+-----+
|        |                           |     |
| フォルダ |        画像表示領域         | タグ |
| ツリー  |                           | パネル|
|        |                           |     |
|        |                           |     |
+--------+---------------------------+-----+
| ステータスバー                            |
+------------------------------------------+
```

### 2.2 各コンポーネントの詳細

#### 2.2.1 メニューバー

メニューバーは以下のメニューを含む：

1. **ファイル**
   - フォルダを開く (Ctrl+O)
   - 最近開いたフォルダ
   - 画像を保存 (Ctrl+S)
   - 別名で保存 (Ctrl+Shift+S)
   - 印刷 (Ctrl+P)
   - 終了 (Alt+F4)

2. **編集**
   - コピー (Ctrl+C)
   - 切り取り (Ctrl+X)
   - 貼り付け (Ctrl+V)
   - 削除 (Delete)
   - 名前の変更 (F2)
   - すべて選択 (Ctrl+A)

3. **表示**
   - ズームイン (Ctrl++)
   - ズームアウト (Ctrl+-)
   - 原寸表示 (Ctrl+0)
   - 画面に合わせる (Ctrl+1)
   - 幅に合わせる (Ctrl+2)
   - 全画面表示 (F11)
   - 回転（時計回り） (R)
   - 回転（反時計回り） (Shift+R)
   - フィルタリング設定
   - サムネイル表示サイズ

4. **分類**
   - 現在の画像を分類
   - フォルダを一括分類
   - 分類モデル設定
   - NSFW表示設定
   - タグ管理

5. **ツール**
   - 設定
   - モデルマネージャー
   - バッチ処理
   - キーボードショートカット設定
   - 統計情報

6. **ヘルプ**
   - ヘルプ表示 (F1)
   - チュートリアル
   - アップデート確認
   - バージョン情報

#### 2.2.2 ツールバー

ツールバーには、よく使う機能のアイコンボタンを配置する：

1. **フォルダを開く**: フォルダ選択ダイアログを開く
2. **前の画像**: 前の画像に移動
3. **次の画像**: 次の画像に移動
4. **ズームイン**: 画像を拡大
5. **ズームアウト**: 画像を縮小
6. **原寸表示**: 元のサイズで表示
7. **画面に合わせる**: 画面サイズに合わせて表示
8. **回転（時計回り）**: 画像を90度回転
9. **回転（反時計回り）**: 画像を-90度回転
10. **全画面表示**: 全画面モードに切り替え
11. **分類実行**: 現在の画像を分類
12. **タグ付け**: 現在の画像にタグを付ける
13. **NSFW表示切替**: NSFWコンテンツの表示/非表示を切り替え

#### 2.2.3 フォルダツリー

左側のパネルにフォルダツリーを表示し、フォルダの階層構造をナビゲートできるようにする：

- ファイルシステムのフォルダ構造を表示
- 展開/折りたたみ可能なツリー構造
- 現在開いているフォルダをハイライト表示
- コンテキストメニューによる操作（新規フォルダ作成、削除、リネームなど）
- ドラッグ＆ドロップによるフォルダ移動
- お気に入りフォルダのブックマーク機能

#### 2.2.4 画像表示領域

中央の領域に画像を表示する：

- 画像のスムーズな拡大/縮小表示
- ドラッグによる画像の移動（パン）
- 画像の回転表示
- 連続表示モード（スライドショー）
- マウスホイールによるズーム操作
- ダブルクリックで全画面表示に切り替え
- 右クリックでコンテキストメニュー表示
- タブ表示で複数画像の切り替え（オプション）

**グリッドビューモード**:
画像表示領域をサムネイルグリッド表示に切り替えることができる：

- サムネイル表示サイズの調整機能
- サムネイル上でのNSFW表示/非表示の視覚的なインジケーター
- サムネイルのフィルタリング機能（タグ、NSFW状態など）
- ドラッグ＆ドロップによる並び替え
- 複数選択による一括操作

#### 2.2.5 タグパネル

右側のパネルに画像のタグ情報を表示する：

- カテゴリごとにグループ化されたタグ一覧
- タグの信頼度（スコア）表示
- タグの追加/削除/編集機能
- タグのフィルタリング機能
- タグのソート機能（アルファベット順、信頼度順など）
- タグをクリックすると同じタグが付いた画像に絞り込み表示

#### 2.2.6 NSFW情報表示

現在の画像がNSFWと分類された場合の情報表示：

- NSFW状態を示す視覚的インジケーター
- NSFWスコアの表示（0.0〜1.0）
- 使用された分類モデルの情報
- 手動での判定変更ボタン

#### 2.2.7 ステータスバー

画面下部のステータスバーには以下の情報を表示：

- 現在の画像のファイル名
- 画像サイズ（ピクセル数）
- ファイルサイズ
- 現在の表示倍率
- 現在の画像番号 / 総画像数
- NSFW状態インジケーター
- メモリ使用量
- 進行中の処理のプログレスバー

### 2.3 レイアウト調整機能

ユーザーが各パネルのサイズを調整できるよう、以下の機能を実装：

- 各パネル間の境界をドラッグしてサイズ変更
- パネルの表示/非表示切り替え
- レイアウトプリセットの保存/読み込み
- パネルの分離（フローティングウィンドウ化）

### 2.4 ダークモード/ライトモード

アプリケーション全体のテーマを切り替える機能：

- ダークモード（暗い背景、明るいテキスト）
- ライトモード（明るい背景、暗いテキスト）
- システム設定に従うオプション
- カスタムアクセントカラーの設定

### 2.5 キーボードナビゲーション

キーボードでも効率的に操作できるよう、以下のショートカットを実装：

- 矢印キー：画像の移動（前/次）
- Ctrl+矢印キー：高速移動
- Space/Enter：拡大/縮小の切り替え
- Home/End：最初/最後の画像に移動
- Tab：パネル間の移動
- Ctrl+F：検索
- F5：表示の更新

## 3. 設定画面の設計

設定画面では、アプリケーションの動作をカスタマイズするための各種設定を行う。

### 3.1 設定カテゴリ

設定画面は以下のカテゴリでタブ分けされる：

1. **一般**
   - 言語設定
   - 起動時の動作
   - 最近使ったフォルダの履歴サイズ
   - 自動更新確認

2. **表示**
   - テーマ（ダーク/ライト）
   - アクセントカラー
   - フォントサイズ
   - サムネイルサイズ
   - デフォルト表示モード
   - アニメーション効果

3. **分類**
   - デフォルトNSFWモデル
   - デフォルトタグ付けモデル
   - NSFWしきい値
   - タグ付けしきい値
   - 自動分類設定
   - バッチ処理設定

4. **フォルダ**
   - デフォルトフォルダ
   - 除外フォルダ
   - フォルダスキャン深さ
   - 隠しファイルの表示

5. **パフォーマンス**
   - キャッシュサイズ
   - サムネイル生成ポリシー
   - 先読み設定
   - 並列処理数

6. **キーボード**
   - ショートカットキーの設定
   - カスタムキーマップの保存/読み込み

7. **プライバシー**
   - ローカル履歴の保存期間
   - 統計情報の収集可否
   - NSFWコンテンツの表示設定

### 3.2 設定UI要素

各設定項目には、適切なUI要素を使用する：

- チェックボックス：オン/オフの切り替え
- ラジオボタン：排他的な選択肢
- ドロップダウンリスト：複数選択肢からの選択
- スライダー：範囲内の値の調整
- 数値入力：正確な数値指定
- ファイル/フォルダ選択：パス指定
- カラーピッカー：色の選択
- キーバインディング入力：ショートカットキーの設定

### 3.3 設定の保存と適用

- 「適用」ボタン：設定を即時適用
- 「OK」ボタン：設定を適用して閉じる
- 「キャンセル」ボタン：変更を破棄して閉じる
- 「デフォルトに戻す」ボタン：デフォルト設定に戻す
- 設定のインポート/エクスポート機能

## 4. 分類管理画面の設計

分類管理画面では、機械学習モデルの管理と実行を行う。

### 4.1 モデル管理タブ

- 利用可能なモデルのリスト表示
  - モデル名
  - タイプ（NSFW検出、タグ付け、キャラクター識別）
  - バージョン
  - ファイルサイズ
  - 最終使用日時
- 新規モデルのインポート機能
- モデルの削除機能
- モデルのプロパティ表示（詳細情報）
- デフォルトモデルの設定
- モデルのアップデート確認

### 4.2 バッチ処理タブ

- 処理対象フォルダの選択
- サブフォルダを含むかどうかの設定
- 実行する処理の選択
  - NSFW分類
  - タグ付け
  - キャラクター識別
- 使用するモデルの選択
- しきい値設定
- 実行ボタン
- 中断ボタン
- 進捗表示
  - 現在処理中のファイル
  - 完了数/総数
  - 推定残り時間
  - ログ表示
- 処理結果の概要表示
  - 処理完了数
  - エラー数
  - NSFW分類結果の分布
  - 検出されたタグの分布

### 4.3 モデル詳細設定

- モデル固有のパラメータ設定
  - 前処理パラメータ
  - 推論パラメータ
  - 後処理パラメータ
- モデルのパフォーマンス設定
  - バッチサイズ
  - スレッド数
  - メモリ使用量
  - GPUアクセラレーション設定

## 5. タグ管理画面の設計

タグ管理画面では、タグの管理と編集を行う。

### 5.1 タグ一覧

- タグのリスト表示
  - タグ名
  - カテゴリ
  - 使用数
  - 作成/更新日時
- フィルタリング機能
  - カテゴリによるフィルタリング
  - 名前による検索
  - 使用頻度によるフィルタリング
- ソート機能
  - アルファベット順
  - 使用頻度順
  - カテゴリ順
  - 作成/更新日時順

### 5.2 タグ編集

- タグ名の編集
- カテゴリの編集
- タグの削除
- タグのマージ
- カスタムタグの作成
- タグの色設定

### 5.3 タグ関連機能

- タグの一括操作
- タグのインポート/エクスポート
- タグの階層構造設定
- 同義タグの設定
- タグの自動補完辞書の管理

## 6. ユーザーフロー

### 6.1 基本的な画像閲覧フロー

```
1. アプリケーション起動
   ↓
2. フォルダを開く
   ↓
3. フォルダ内の画像一覧が表示される
   ↓
4. 画像を選択して表示
   ↓
5. 矢印キーで前後の画像に移動
   ↓
6. 必要に応じてズーム・回転操作
   ↓
7. 次のフォルダに移動 or アプリケーション終了
```

### 6.2 画像分類フロー

```
1. 画像を表示
   ↓
2. 「分類」ボタンをクリック
   ↓
3. 分類処理が実行される
   ↓
4. 分類結果が表示される
   ↓
5. 必要に応じて手動で結果を調整
   ↓
6. 次の画像に移動
```

### 6.3 バッチ処理フロー

```
1. ツールメニューから「バッチ処理」を選択
   ↓
2. 処理対象フォルダを選択
   ↓
3. 実行する処理と使用するモデルを選択
   ↓
4. パラメータを設定
   ↓
5. 「実行」ボタンをクリック
   ↓
6. 処理の進捗が表示される
   ↓
7. 処理完了後、結果の概要が表示される
   ↓
8. 「閉じる」ボタンをクリックして画面を閉じる
```

## 7. レスポンシブデザイン

アプリケーションは様々な画面サイズやウィンドウサイズに対応するために、レスポンシブなデザインを採用する。

### 7.1 ウィンドウサイズ変更時の挙動

- 最小ウィンドウサイズの設定
- パネルの自動サイズ調整
- 要素の折りたたみ/展開
- ツールバーアイコンの自動調整（テキスト表示/アイコンのみ）

### 7.2 コンパクトモード

画面サイズが小さい場合、または設定により以下のコンパクトモードを使用可能：

- サイドパネルの自動折りたたみ
- タブ化されたインターフェース
- 簡略化されたメニュー
- ポップアップパネル

## 8. アクセシビリティ設計

様々なユーザーが使いやすいアプリケーションとするため、以下のアクセシビリティ機能を実装する：

### 8.1 キーボード操作

- 全ての機能がキーボードだけで操作可能
- フォーカスの視覚的表示
- ショートカットキーのカスタマイズ

### 8.2 表示設定

- フォントサイズの調整
- 高コントラストモード
- 色覚特性に配慮した配色
- テキストとアイコンの併用

### 8.3 補助機能

- スクリーンリーダー対応
- ツールチップと説明文の提供
- エラーメッセージの明確な表示
- 操作の取り消し/やり直し機能

## 9. エラー処理とフィードバック

### 9.1 エラーメッセージ

エラーが発生した場合、以下の情報を含む明確なメッセージを表示：

- エラーの内容
- 発生原因
- 対処方法
- 詳細情報へのアクセス方法

### 9.2 確認ダイアログ

重要な操作の前には確認ダイアログを表示：

- 実行する操作の内容
- 影響範囲
- キャンセルオプション
- 「次回から表示しない」オプション（適切な場合）

### 9.3 操作フィードバック

ユーザー操作に対するフィードバックを提供：

- ボタンの視覚的フィードバック
- 操作完了の通知
- 長時間処理の進捗表示
- 成功/失敗の明確な表示

## 10. UI/UXプロトタイプ

### 10.1 メイン画面のプロトタイプ

メイン画面の基本レイアウトは以下のようになる：

```
+----------------------------------------------------------+
| ファイル 編集 表示 分類 ツール ヘルプ                        |  メニューバー
+----------------------------------------------------------+
| [フォルダ] [<] [>] [+] [-] [1:1] [回転] [分類] [タグ]       |  ツールバー
+----------+---------------------------+-------------------+
|          |                           |                   |
|  フォルダ  |                           |                   |
|  ツリー   |                           |                   |
|          |                           |                   |
|  □ ピクチャ|                           |                   |
|   ├ 2023 |       画像表示領域          |     タグパネル     |
|   ├ 2022 |                           |                   |
|   └ 2021 |                           | [キャラクター]      |
|          |                           |  □ キャラA        |
|  □ ダウン  |                           |  □ キャラB        |
|  ロード   |                           |                   |
|          |                           | [スタイル]         |
|  □ 外付け |                           |  □ イラスト        |
|  ドライブ  |                           |  □ 水彩           |
|          |                           |                   |
+----------+---------------------------+-------------------+
| 画像: sample.jpg  |  1280x720  |  500KB  |  表示: 100%     |  ステータスバー
+----------------------------------------------------------+
```

### 10.2 設定画面のプロトタイプ

```
+----------------------------------------------------------+
|                      設定                                 |
+----------+-----------------------------------------------+
|          |                                               |
|  一般     |  □ 起動時に前回のフォルダを開く                   |
|          |  □ 終了時に設定を保存                           |
|  表示     |  □ ダブルクリックで全画面表示                    |
|          |                                               |
|  分類     |  言語: [日本語 ▼]                             |
|          |                                               |
|  フォルダ   |  テーマ: ○ ライト  ● ダーク  ○ システム設定に従う  |
|          |                                               |
|  パフォー   |  サムネイルサイズ: [------●------]              |
|  マンス    |                                               |
|          |  キャッシュサイズ: [   500   ] MB                |
|  キーボード |                                               |
|          |  □ 画像を開いたときに自動分類                     |
|  プライバ  |  □ バックグラウンドでサムネイル生成               |
|  シー     |                                               |
|          |                                               |
+----------+-----------------------------------------------+
|    [デフォルトに戻す]      [キャンセル]      [OK]            |
+----------------------------------------------------------+
```

### 10.3 バッチ処理画面のプロトタイプ

```
+----------------------------------------------------------+
|                    バッチ処理                              |
+----------------------------------------------------------+
|  処理対象フォルダ: [C:\Users\username\Pictures\] [参照...]  |
|  □ サブフォルダを含む                                      |
+----------------------------------------------------------+
|  実行する処理:                                             |
|  ■ NSFW分類     モデル: [default ▼]    しきい値: [0.6]     |
|  ■ タグ付け      モデル: [danbooru ▼]   しきい値: [0.5]     |
|  □ キャラクター識別 モデル: [default ▼]                     |
+----------------------------------------------------------+
|  処理オプション:                                           |
|  □ 既存の分類結果を上書き                                   |
|  □ エラーが発生しても継続                                   |
|  □ 処理完了後に結果をエクスポート                            |
+----------------------------------------------------------+
|  [進捗バー                                          ]     |
|  処理中: sample.jpg (123/500)                            |
|  推定残り時間: 2分30秒                                     |
+----------------------------------------------------------+
|                [中断]         [実行]                      |
+----------------------------------------------------------+
```

## 11. 実装ガイドライン

### 11.1 UI実装の技術的考慮事項

- **Qt Designerの活用**: UI設計にはQt Designerを使用してレイアウトを作成
- **スタイルシートの使用**: カスタムスタイルはQSSを活用
- **動的UI生成**: 一部のUIは動的に生成されるため、適切なファクトリーパターンを実装
- **イベント処理**: Signal/Slot機構を活用した効率的なイベント処理
- **非同期処理**: UIをブロックしないよう、長時間の処理は別スレッドで実行

### 11.2 UI/UXテスト

実装後のテストでは以下の観点を確認する：

- 各UI要素が正しく表示されるか
- レスポンシブデザインが正しく動作するか
- キーボード操作が正しく機能するか
- アクセシビリティ機能が正しく動作するか
- パフォーマンスが要求を満たしているか
- エラー処理が適切に機能するか
- ユーザビリティテスト（実際のユーザーによる評価）

### 11.3 国際化対応

- 文字列リソースの外部化
- 複数言語対応（日本語、英語など）
- 地域固有の日付/時刻形式対応
- 右から左へ書く言語（RTL）の考慮

本UI/UX設計書に基づいて実装することで、エロ絵と健全絵を分類する機能を持つ使いやすい画像ビューワーアプリケーションが実現できる。
