# 画像分類機能の要件定義

## 2.1 分類対象と基準
- **分類カテゴリ**:
  - 健全絵（Safe For Work、SFW）: 一般的に職場や公共の場で閲覧しても問題ない画像
  - エロ絵（Not Safe For Work、NSFW）: 露出が多い、性的な描写を含む画像
  
- **分類基準**:
  - 露出度（肌の露出面積、位置）
  - 姿勢や表情（性的なポーズ、表情）
  - 性的な行為や状況の描写
  - コンテキスト情報（背景、状況）

## 2.2 技術的アプローチ
- **使用技術**: 深層学習（CNN: 畳み込みニューラルネットワーク）を用いた画像分類
- **モデル候補**:
  1. **イラスト特化NSFW検出モデル**:
     - GantMan/nsfw_model: アニメ・イラストを含む画像のNSFW検出
     - Danbooruデータセットでチューニングされたモデル
     - グレースケール画像にも対応するモデル・前処理
  
  2. **画像タグ付けモデル**:
     - Danbooru Tagger: アニメ画像の詳細なタグ付けが可能
     - DeepDanbooru: アニメ画像に特化したタグ付けモデル
     - タグベースでのNSFW判定（特定のタグに基づくフィルタリング）
     - キャラクター識別とそれに基づく分類
  
  3. **複数モデルの併用**:
     - 各モデルの強みを活かしたアンサンブル判定
     - モデル間の判定結果統合アルゴリズム
     - 信頼度重み付けによる最終判定
     - 判定結果の競合解決メカニズム
  
  4. **カスタムモデルの構築・学習**:
     - 転移学習: 既存の画像分類モデル（ResNet、MobileNet、EfficientNetなど）をベースに微調整
     - データセット: 健全絵とエロ絵の画像データセットを収集して学習

## 2.3 実装要件
- **分類エンジン**:
  - ローカル実行（プライバシー保護のため）
  - バッチ処理機能（大量画像の一括分類）
  - 増分学習機能（ユーザーのフィードバックを基に精度向上）
  - 分類速度と精度のバランス調整機能
  - 動画（MP4）のフレーム抽出と分類機能
  - 複数モデルの実行管理と結果統合

- **分類情報の管理**:
  - 分類結果のメタデータとしての保存
  - 分類タグのカスタマイズ（ユーザー定義カテゴリ）
  - 分類結果の編集機能（誤分類の修正）
  - 分類履歴の管理
  - キャラクター別分類とタグベース分類の統合管理
  - 詳細なタグ情報の保存と検索機能

- **UIと操作性**:
  - 分類結果の視覚的表示（色分け、アイコン、フォルダ分け）
  - フィルタリング機能（特定カテゴリの表示/非表示）
  - 信頼度スコア表示（分類の確実性）
  - 分類閾値の調整機能（感度調整）

## 2.4 プライバシーと制御
- **プライバシー保護**:
  - オフライン処理によるデータ流出防止
  - ローカルモデル使用による外部サービス不使用

- **表示制御**:
  - NSFW画像のフォルダ分け
  - フィルタリングモード
  - 閉覧機能

## 2.5 性能要件
- **応答時間**:
  - 単一画像の分類: 1秒以内
  - バッチ処理: 画像100枚あたり1分以内

- **精度目標**:
  - 正確性: 90%以上（健全絵とエロ絵の区別）
  - 誤検出率（False Positive）: 10%以下
  - 見逃し率（False Negative）: 5%以下

## 2.6 拡張性
- **モデル更新**:
  - 新しい分類モデルへの置き換え機能
  - モデルのバージョン管理
  - モデルプラグイン機構（新しいモデルの容易な追加）

- **追加分類**:
  - 将来的に中間カテゴリ（軽度NSFW）などの追加
  - 他のコンテンツ分類（暴力、グロテスク）への拡張の可能性
  - キャラクターベースの自動フォルダ振り分け
  - アートスタイルに基づく分類
  - 新しいタグ体系への対応